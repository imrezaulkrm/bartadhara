<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News App</title>
    <style>
        /* styles.css */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        header {
            background-color: #333;
            color: white;
            padding: 15px;
            text-align: center;
        }

        header nav {
            margin-top: 10px;
        }

        header nav a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
            font-size: 16px;
        }

        #user-info {
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #user-info img {
            margin-right: 10px;
        }

        #filters {
            margin: 20px;
        }

        #category-filters {
            display: flex;
            flex-wrap: wrap;
        }

        #category-filters label {
            margin: 5px 15px;
        }

        #news-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between; /* Adjusted to reduce gap */
            padding: 20px;
        }

        .news-item {
            background-color: white;
            width: 20%; /* Smaller size */
            margin: 2px; /* Reduced gap between boxes */
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease; /* Smooth transition */
        }

        .news-item:hover {
            transform: scale(1.05); /* Slight zoom on hover */
        }

        .news-item img {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9; /* 16:9 ratio */
            border-radius: 8px;
        }

        .news-item h2 {
            font-size: 16px;
            margin: 10px 0;
        }

        .news-item p {
            font-size: 12px;
            color: #555;
        }

        .news-item .description {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
        }

        .news-item .see-more {
            color: blue;
            text-decoration: underline;
            cursor: pointer;
        }

        .news-item .footer {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 10px;
            color: #777;
        }


    </style>
</head>
<body>
    <header>
        <h1>Welcome to the News App</h1>
        <nav>
            <a href="register.html">Register</a>
            <a href="login.html">Login</a>
        </nav>
        <div id="user-info" style="display: none;">
            <img id="user-picture" src="" alt="User Picture" style="border-radius: 50%; width: 50px; height: 50px;">
            <span id="user-name"></span>
        </div>
    </header>

    <main>
        <section id="filters">
            <h2>Filter by Category</h2>
            <div id="category-filters"></div>
        </section>

        <section id="news-container">
            <p>Loading news...</p>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const newsContainer = document.getElementById('news-container');
            const categoryFilters = document.getElementById('category-filters');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const userPicture = document.getElementById('user-picture');

            let newsData = [];
            let selectedCategories = [];

            // Fake user data (Normally this would come from the server)
            const user = JSON.parse(localStorage.getItem('user')); // Logged-in user info

            if (user) {
                userName.textContent = user.name; // Show the user's name
                userPicture.src = user.picture; // Show the user's picture
                userInfo.style.display = 'flex'; // Display user info
            }

            async function loadNews() {
                try {
                    const response = await fetch('http://localhost:8080/news');
                    if (!response.ok) {
                        throw new Error('Failed to fetch news');
                    }

                    newsData = await response.json();
                    renderNews(newsData);
                    renderCategoryFilters(newsData);
                } catch (error) {
                    console.error(error);
                    newsContainer.innerHTML = '<p>Error loading news.</p>';
                }
            }

            function renderNews(filteredNews) {
                newsContainer.innerHTML = ''; // Clear previous news

                if (filteredNews.length === 0) {
                    newsContainer.innerHTML = '<p>No news available for the selected category.</p>';
                    return;
                }

                filteredNews.forEach(news => {
                    const newsItem = document.createElement('div');
                    newsItem.classList.add('news-item');

                    newsItem.innerHTML = `
                        <img src="${news.image}" alt="${news.title}" onerror="this.onerror=null; this.src='fallback-image.jpg';">
                        <h2>${news.title}</h2>
                        <p class="description">${news.description}</p>
                        <span class="see-more" id="see-more-${news.id}">See more</span>
                        <div class="footer">
                            <span>${news.date}</span>
                            <span>${news.category}</span>
                        </div>
                    `;

                    newsContainer.appendChild(newsItem);

                    // Add event listener for 'See more' button
                    document.getElementById(`see-more-${news.id}`).addEventListener('click', function() {
                        viewNewsDetails(news.id);
                    });
                });
            }

            function renderCategoryFilters(newsData) {
                const categories = [...new Set(newsData.map(news => news.category))]; // Extract unique categories
                categoryFilters.innerHTML = ''; // Clear previous filters

                categories.forEach(category => {
                    const label = document.createElement('label');
                    label.innerHTML = `
                        <input type="checkbox" value="${category}"> ${category}
                    `;
                    categoryFilters.appendChild(label);
                });

                categoryFilters.addEventListener('change', handleCategoryFilter);
            }

            function handleCategoryFilter() {
                selectedCategories = Array.from(categoryFilters.querySelectorAll('input[type="checkbox"]:checked')).map(checkbox => checkbox.value);
                
                if (selectedCategories.length === 0) {
                    renderNews(newsData); // Show all news if no category is selected
                } else {
                    const filteredNews = newsData.filter(news => selectedCategories.includes(news.category));
                    renderNews(filteredNews);
                }
            }

            function viewNewsDetails(newsID) {
                console.log("Navigating to news details with ID:", newsID); // Log newsID for debugging
                window.location.href = `news-details.html?id=${newsID}`; // Navigate to the news details page
            }

            loadNews();
        });
    </script>
</body>
</html>


